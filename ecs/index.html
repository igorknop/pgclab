<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ECS Render Test</title>
  </head>
  <body>
    <h1>ECS Render Test</h1>
    <canvas></canvas>

    <script type="module" defer>
      import EntityManager from "./EntityManager.js";
      import Render from "./systems/Render.js";
      import PositionComponent from "./components/PositionComponent.js";
      import BoxComponent from "./components/BoxComponent.js";
      import VelocityComponent from "./components/VelocityComponent.js";
      import Move from "./systems/Move.js";

      const canvas = document.querySelector("canvas");
      const ctx = canvas.getContext("2d");
      let t0 = 0;
      let dt;

      const entityManager = new EntityManager();

      const e1 = entityManager.createEntity();
      e1.addComponent(new PositionComponent(30, 50));
      e1.addComponent(new BoxComponent(40, 20));
      e1.addComponent(new VelocityComponent());

      requestAnimationFrame(animationStep);

      function animationStep(t) {
        t0 = t0 ?? t;
        dt = (t - t0) / 1000;
        entityManager.update(Move, { dt });
        entityManager.update(Render, { ctx, canvas });
        t0 = t;
        requestAnimationFrame(animationStep);
      }
    </script>

    <button>Play</button>
    <button>Pause</button>
    <button>Reset</button>
  </body>
</html>
